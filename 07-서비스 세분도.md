# 7. 서비스 세분도
- 모듈화 : 사용상의 유연성과 다양성을 위해 표준화된 단위 또는 치수로 만듦
- 세분도 : 더 큰 단위를 형성하는 많은 입자 중 하나로 구성하거나, 그렇게 보임

- 모듈화는 시스템을 별도의 파트로 분하는것과 관련이 있는 반면, 세분도는 그렇게 나뉘어진 개별파트의 사이즈에 관한 것
- 분산 시스템의 이슈와 난제를 들여다보면 모듈화보다는 세분도와 연관된 경우가 대부분
- 메트릭을 통해 서비스의 여러측면을 모니터링 하고 분석해서 적정한 세분도를 결정

- 분해인 : '어떤 경우에 서비스를 더 잘게 나눠야 하는가?'
- 통합인 : '어떤 경우에 서비스를 다시 합쳐야 하는가?'

## 7.1 세분도 분해인
 어떤 경우에 서비스를 더 잘게 나눠야 하는지에 관한 지침과 정상성을 제시
 - 서비스의 범위와 기능: 서비스가 자신과 무관한 일을 너무 많이 하고 있는가?
 - 코드 변동성: 변경이 어느 한부분에만 국한돼 있는가?
 - 확장성/처리량: 서비스 파트마다 확장을 달리해야 하는가?
 - 내고장성: 중대한 기능 실패를 유발하는 에러가 서비스에 존재하는가?
 - 보안: 서비스의 어떤 파트가 다른 파트보다 높은 보안 수준을 필요로 하는가?
 - 신장성: 서비스가 항상 새로운 콘텍스트를 추가하기 위해 확장하고 있는가?
 
### 7.1.1 서비스의 범위와 기능
 첫째, 서비스가 하는일이 얼마나, 어떻게 서로 연관돼 있는지를 나타내는 응집도입니다. 둘째, 컴포넌트의 전체 사이즈
 어떤 서비스를 구성하는 클래스에 구현된 총문장 수나 서비스 진입점 수, 또는 이 둘을 모두 계산해서 측정
### 7.1.2 코드 변동성
 서비스 코드가 얼마나 자주 바뀌는지를 객관적으로 측정하면 서비스를 분해해야하는 타당성 명분
### 7.1.3 확장성/처리량
 
### 7.1.4 내고장성
 중대한 장애가 발생해도 특정 도메인에 있는 애플리케이션 또는 기능을 중단없이 가동시키는 능력
### 7.1.5 보안
 
### 7.1.6 신장성
 서비스 영역이 확장될수록 기능을 부가할 수 있는 능력


## 7.2 세분도 통합인
 어떤 경우에 서비스를 다시 합쳐야 하는지(또는 애당초 서비스를 분리하지 말아야 하는지)에 대한 가이드라인과 명분을 제공  

 - 데이터베이스 트랜잭션: 각 서비스 간에 ACID 트랜잭션이 필수인가?
 - 워크플로 코레오그래피: 서비스들이 서로 소통해야 하는가?
 - 공유 코드: 서비스들이 서로 코드를 공유해야 하는가?
 - 데이터관계: 서비스가 분해되면 그 서비스가 사용하는 데이터도 함께 나눠야 하는가?

### 7.2.1 데이터베이스 트랜잭션
 - 서비스가 작업 도중 실패하면, 데이터 무결성이 깨지고 원래 프로필을 다시 삽입하는 등의 복잡한 복원처리가 불가피.  
 - 비즈니스 관점에서 단일 작업 단위의 ACID 트랜잭션이 필요한 프로세스는 한 서비스로 통합해야함
### 7.2.2 워크플로 코레오그래피

- 서비스를 잘게 나누다 보면 언제가 서비스 간 통신이 점점 늘어나 부정적인 영향을 끼치기 시작하는지점에 이름
- 서비스간 통신이 과도해지면 무엇보다 내고장성 이슈가 생김 
- 따라서 전체 내고장성, 가용성, 신뢰성 이 큰 타격을 받음

- 과도한 워크플로는 내고장성에 좋지 않다
- 과도한 워크플로는 전체 성능과 응답성 측면에서도 좋지않다
- 과도한 워크플로는 신뢰성과 데이터 무결성에도 영향을 끼친다

 흥미로운건 내고장성은 세분도 분해인중 하나였지만 나뉘어진 서비스들이 서로 통신해야할 경우에는 내고장성 측면에서 얻은게 아무것도 없다는 사실
### 7.2.3 공유코드
 - 공유코드는 jar, gem, dll 등의 공유라비으러리 형태로 존재하며, 대부분 컴파일 타임에 서비스에 바인딩
 - 공유 라이브러리를 변경할 일이 생기면 결과적으로 이 라이브러리를 사용하는 서비스도 함께 찾아 변경해야 함. 함께 변경하고, 테스트하고 배되야 함.
 - 인프라 관련 횡단 기능은은 동인에 해당에는 어울리지 않음
 - 공유코드 통합인 가이드라인
  - 특정한 공유 도메인 기능
  - 공유 코드의 잦은 변경
  - 결함은 버저닝이 안된다
### 7.2.4 데이터 관계
 서비스를 분해해 나뉘어진 데이터는 공유되지 않으며, 변경 관리를 용이하게 하고 전반적인 가용성 및 신뢰성을 뒷받침하기 위해 데이터는 각 서비스 내부에서 엄격한 경계 콘텍스트 형태로 나타난다고 보는것
### 7.3 적정 균형점 찾기
